OBJDIRS += tests

TESTS_SRCFILES := \
		src/tests/tests.cc \
		src/server/server.c \
		src/shared/net.c \
		src/tests/server.cc

TESTS_OBJFILES := $(TESTS_SRCFILES)
TESTS_OBJFILES := $(patsubst src/tests/%.c, $(OBJDIR)/tests/%.o, $(TESTS_OBJFILES))
TESTS_OBJFILES := $(patsubst src/shared/%.c, $(OBJDIR)/shared/%.o, $(TESTS_OBJFILES))
TESTS_OBJFILES := $(patsubst src/server/%.c, $(OBJDIR)/server/%.o, $(TESTS_OBJFILES))
TESTS_OBJFILES := $(patsubst src/tests/%.cc, $(OBJDIR)/tests/%.o, $(TESTS_OBJFILES))

TESTS_LIB := -lcppunit

$(OBJDIR)/tests/tests: $(TESTS_OBJFILES)
	@mkdir -p $(@D)
	$(CXX) $(TESTS_LIB) -o $@ $^

$(OBJDIR)/tests/%.o: $(TOP)/src/tests/%.c
	@mkdir -p $(@D)
	$(CC) $(CFLAGS) -c -o $@ $<

$(OBJDIR)/shared/%.o: $(TOP)/src/shared/%.c
	@mkdir -p $(@D)
	$(CC) $(CFLAGS) -c -o $@ $<

$(OBJDIR)/tests/%.o: $(TOP)/src/tests/%.cc
	@mkdir -p $(@D)
	$(CXX) $(CXXFLAGS) -c -o $@ $<

tests: $(OBJDIR)/tests/tests
	$(OBJDIR)/tests/tests
